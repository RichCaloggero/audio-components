<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>test</title>
</head>
<body>
<h1>Test</h1>

<t-1>
<t-2></t-2>
</t-1>

<script type="module">
let t1count = 0;
let t2count = 0;

class T1 extends HTMLElement {
get template () {
return `
<div class="${this.id}">
<h2>${this.id}</h2>
</div>

<slot></slot>
`;
} // get template

constructor () {
super ();
t1count += 1;
this.id = `t-1-${t1count}`;
this.audio = new AudioContext();
} // constructor

connectedCallback () {
createDom.call(this);
console.log(`${this.id} connected`);
} // connectedCallback
} // class T1

class T2 extends T1 {
get template () {
return `
<fieldset class="${this.id}">
<legend><h3>${this.id}</h3></legend>
<button id="play">Play</button>
</fieldset>
`;
} // get template

constructor () {
super();
t2count += 1;
this.id = `t-2-${t2count}`;

this.audioElement = document.createElement("audio");
this.audioSource = this.audio.createMediaElementSource(this.audioElement);
this.audioSource.connect(this.audio.destination);
this.audioElement.src = "./t1.mp3";
} // constructor

connectedCallback () {
createDom.call(this);
this.shadowRoot.addEventListener("click", this.play.bind(this));
console.log(`${this.id} connected`);
} // connectedCallback

play (e) {
if (this.audioElement.paused) {
this.audioElement.play();
e.target.textContent = "pause";
} else {
this.audioElement.pause();
e.target.textContent = "play";
} // if

e.target.focus();
} // play
} // class T2

customElements.define("t-1", T1);
customElements.define("t-2", T2);


function createDom () {
const root = this.attachShadow({mode: "open"});
root.innerHTML = this.template;
} // createDom

function _template (element, level) {
return `
<div class="${element.id}">
<h${level}>${element.id}</h${level}>
<div class="message" aria-live="polite"></div>
</div>

${(level < 4)? "<slot></slot>" : ""}
`;
} // _template

</script>

</body>
</html>
