<!doctype html>
<head>
<meta charset="utf-8">
<title>Phase Panner</title>
<!--<script src="./resonance-audio.min.js" crossorigin="anonymous"></script>-->
<script src="loader.js"></script>
</head>
<body>
<fieldset id="parameters">
<legend><h2>Parameters</h2></legend>
<div id="statusMessage" role="status"></div>
<label for="crossover">crossover: </label>
<input id="crossover" type="number" min="500" value="700" max="2500" step="10" accesskey="c">

<label>Q: <input id="q" type="range" min="0" value="1" max="10" step=".1" accesskey="q"></label>
<!--<label>rate: <input id="rate" type="range" min="20" value="50" max="1000" step="10" accesskey="r"> milliseconds</label>-->
<label>phase: <input id="phase" type="range" min="0" value="0" max="90" step=".1" accesskey="p"></label>

</fieldset>


<audio-context automation-interval="0.05" hide="bypass" label="Phase Panner" shortcuts="enableAutomation alt shift r">
<audio-series>
<audio-player label="player" shortcuts="src alt shift u" src="media/D2_02_Thats What Love Will Make You Do.flac"></audio-player>

<audio-series id="master" label="master" mix="-1">

<audio-series id="container" >
<audio-parallel>
<audio-series id="lowband" silent-bypass label="low band" hide="mix">
<audio-filter type="lowpass" frequency="1000" q="4"></audio-filter>
<audio-channelSwap></audio-channelSwap>
<audio-control>
<audio-stereo-processor label="rotate low" hide="mix, width, center, balance"></audio-stereo-processor>
<audio-parameter label="control rotate low" name="rotation" function="s(t, -90,90)"></audio-parameter>
</audio-control>

</audio-series><audio-series id="highband" silent-bypass label="high band" hide="mix">
<audio-filter type="highpass" frequency="1000" q="4"></audio-filter>
<audio-control>
<audio-stereo-processor label="rotate high" hide="mix, width, center, balance"></audio-stereo-processor>
<audio-parameter label="control rotate high" name="rotation" function="s(t, -90,90)"></audio-parameter>
</audio-control>
</audio-series>
</audio-parallel>

</audio-series><!-- container -->

<audio-gain label="volume" gain="1.5" hide="mix, bypass"></audio-gain>
<audio-filter label="bass" type="lowshelf" frequency="200" gain="4" hide="detune, mix, type"></audio-filter>
<audio-compressor bypass label="compressor" ratio="2" threshold="-30" knee="20" attack="0.2" release="5.0" hide="mix"></audio-compressor>
</audio-series><!-- master -->

<audio-destination label="speakers"></audio-destination>
</audio-series>
</audio-context>

<script>
const container = document.querySelector("#container");
const master = document.querySelector("#master");

document.querySelector("#crossover").addEventListener("change", e => {
filters().forEach(f => f.setAttribute("frequency", Number(e.target.value)))
}); // change

document.querySelector("#q").addEventListener("change", e => {
filters().forEach(f => f.setAttribute("q", Number(e.target.value)))
}); // change

document.querySelector("#q").addEventListener("change", e => {
document.querySelector("audio-context").setAttribute("automationInterval", Number(e.target.value))
});

document.querySelector("#phase").addEventListener("change", e => {
document.querySelector("#lowband audio-stereo-processor").setAttribute("rotation", Number(e.target.value));
document.querySelector("#highband audio-stereo-processor").setAttribute("rotation", -1 * Number(e.target.value));
}); // change

document.querySelectorAll("#parameters input").forEach(e => e.dispatchEvent(new CustomEvent("change")));

function filters () {return container.querySelectorAll("#lowband audio-filter, #highband audio-filter");}
document.querySelector("audio-context").addEventListener("elementReady", e => statusMessage(`${e.target.label || ""} ready.`));

function statusMessage (text) {document.querySelector("#statusMessage").appendChild(document.createTextNode(`${text}\n`));}

</script>

</body>
</html>
