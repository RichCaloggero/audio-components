<dom-module id="ui-file">
<template>
<div  class="ui-file">
<label>{{label}}
<br><input type="file" on-change="fileChanged">
</label>
</div>
</template>

<script>
// ui-file
"use strict";

(function () {
var instanceCount  = 0;

class UIFile extends _AudioContext_ {
static get is() { return "ui-file"; }


static get properties () {
return {
type: String,

name: {
type: String,
value: "",
notify: true,
observer: "nameChanged"
}, // name

label: {
type: String,
value: ""
}, // label

value: {
type: Object,
} // value
}; // return
} // get properties


constructor () {
super ();
instanceCount += 1;
this._id = "ui-file" + instanceCount;
console.log ("constructor...");
} // constructor

_attachDom(dom) {
this.shadowRoot = this.attachShadow({mode: 'open', delegatesFocus: true});
super._attachDom(dom);
} // _attachDom


connectedCallback () {
super.connectedCallback ();
if (! this.name) {
throw new Error ("ui-file: no name given");
} // if
//console.log ("connectedCallback...");
} // connectedCallback


fileChanged (e) {
let file = e.target.files[0];
console.log (`reading file: ${file.name}, type ${this.type}`);

let reader = new FileReader ();
if (! reader) {
throw new Error ("cannot initialize reader");
} // if

reader[this.type] (file);
reader.addEventListener ("load", function () {
this.valueChanged ({type: type, buffer: reader.result});
}); // on load

return true;
} // fileChanged

nameChanged (value) {
if (! this.label) this.label = value;
} // nameChanged

} // class UIFile

function idGen (name) {
return "ui-file" + instanceCount + "-" + name;
} // idGen

window.customElements.define(UIFile.is, UIFile);
})();
</script>
</dom-module>
